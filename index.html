<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>PKD Meals</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiUEtEIE1lYWxzIiwic2hvcnRfbmFtZSI6IlBLRCBNZWFscyIsInN0YXJ0X3VybCI6Ii4iLCJkaXNwbGF5Ijoic3RhbmRhbG9uZSIsImJhY2tncm91bmRfY29sb3IiOiIjZjVmNWYwIiwidGhlbWVfY29sb3IiOiIjMTY2NTM0IiwiaWNvbnMiOlt7InNyYyI6ImRhdGE6aW1hZ2Uvc3ZnK3htbCw8c3ZnIHhtbG5zPSdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Zycgdmlld0JveD0nMCAwIDEwMCAxMDAnPjxyZWN0IHdpZHRoPScxMDAnIGhlaWdodD0nMTAwJyByeD0nMjAnIGZpbGw9JyMxNjY1MzQnLz48dGV4dCB4PSc1MCcgeT0nNjUnIGZvbnQtc2l6ZT0nNTAnIHRleHQtYW5jaG9yPSdtaWRkbGUnPvCfjr08L3RleHQ+PC9zdmc+Iiwic2l6ZXMiOiIxOTJ4MTkyIiwidHlwZSI6ImltYWdlL3N2Zyt4bWwifV19">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#166534">
<script>
tailwind.config = {
  theme: {
    extend: {
      colors: {
        brand: { 50:'#f0fdf4', 100:'#dcfce7', 200:'#bbf7d0', 300:'#86efac', 400:'#4ade80', 500:'#22c55e', 600:'#16a34a', 700:'#166534', 800:'#14532d', 900:'#052e16' }
      }
    }
  }
}
</script>
<style>
@media print { .no-print{display:none!important} body{font-size:11px} }
html{scroll-behavior:smooth}
body{padding-bottom:env(safe-area-inset-bottom,0)}
.tab-content{display:none;animation:fadeIn .2s ease}
.tab-content.active{display:block}
@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
.recipe-card{transition:all .15s}
.recipe-card:active{transform:scale(0.98)}
.check-done{text-decoration:line-through;opacity:.5}
</style>
</head>
<body class="bg-stone-50 text-stone-800 min-h-screen pb-20">

<!-- Header -->
<header class="bg-brand-700 text-white px-4 pt-[env(safe-area-inset-top,12px)] pb-3 no-print">
  <div class="max-w-2xl mx-auto flex items-center justify-between pt-2">
    <h1 class="text-lg font-bold">ğŸ½ï¸ PKD Meals</h1>
    <span class="text-xs opacity-75">dairy-free Â· soy-free Â· low sodium</span>
  </div>
</header>

<!-- Tab Content -->
<main class="max-w-2xl mx-auto px-4 py-4" id="app">
  <!-- Recipes Tab -->
  <div id="tab-recipes" class="tab-content active">
    <div class="flex gap-2 mb-3 overflow-x-auto pb-1">
      <button onclick="filterRecipes('All')" class="cat-filter px-4 py-2 rounded-full text-sm font-semibold bg-brand-600 text-white whitespace-nowrap" data-cat="All">All</button>
      <button onclick="filterRecipes('Breakfast')" class="cat-filter px-4 py-2 rounded-full text-sm font-semibold bg-stone-200 text-stone-600 whitespace-nowrap" data-cat="Breakfast">ğŸ³ Breakfast</button>
      <button onclick="filterRecipes('Lunch')" class="cat-filter px-4 py-2 rounded-full text-sm font-semibold bg-stone-200 text-stone-600 whitespace-nowrap" data-cat="Lunch">ğŸ¥— Lunch</button>
      <button onclick="filterRecipes('Dinner')" class="cat-filter px-4 py-2 rounded-full text-sm font-semibold bg-stone-200 text-stone-600 whitespace-nowrap" data-cat="Dinner">ğŸ– Dinner</button>
      <button onclick="filterRecipes('Snack')" class="cat-filter px-4 py-2 rounded-full text-sm font-semibold bg-stone-200 text-stone-600 whitespace-nowrap" data-cat="Snack">ğŸ¥œ Snack</button>
    </div>
    <div class="mb-3">
      <input id="recipe-search" type="text" placeholder="Search recipes or ingredientsâ€¦" class="w-full px-3 py-2 rounded-lg border border-stone-300 text-sm focus:outline-none focus:ring-2 focus:ring-brand-400">
    </div>
    <div id="recipe-list"></div>
  </div>

  <!-- Pantry Tab -->
  <div id="tab-pantry" class="tab-content">
    <div class="flex items-center justify-between mb-3">
      <h2 class="text-lg font-bold">ğŸ¥¬ My Pantry</h2>
      <button onclick="clearPantry()" class="text-xs text-red-500 hover:text-red-700">Clear All</button>
    </div>
    <div class="flex gap-2 mb-2">
      <input id="pantry-input" type="text" placeholder="Item nameâ€¦" class="flex-1 px-3 py-2 rounded-lg border border-stone-300 text-sm" onkeydown="if(event.key==='Enter')addPantryCustom()">
      <select id="pantry-loc" class="px-2 py-2 rounded-lg border border-stone-300 text-sm bg-white">
        <option>ğŸ§Š Fridge</option><option>â„ï¸ Freezer</option><option>ğŸ  Pantry</option><option>ğŸ¥¦ Produce</option>
      </select>
    </div>
    <div class="flex gap-2 mb-3">
      <input id="pantry-qty" type="number" min="0" step="any" placeholder="Qty" class="w-16 px-2 py-2 rounded-lg border border-stone-300 text-sm text-center">
      <select id="pantry-unit" class="px-2 py-2 rounded-lg border border-stone-300 text-sm bg-white">
        <option value="">â€”</option><option value="ct">ct</option><option value="oz">oz</option><option value="lb">lb</option><option value="g">g</option><option value="cup">cup</option><option value="can">can</option><option value="bag">bag</option><option value="bunch">bunch</option><option value="pkg">pkg</option><option value="bottle">bottle</option><option value="jar">jar</option>
      </select>
      <button onclick="addPantryCustom()" class="flex-1 bg-brand-600 text-white px-3 py-2 rounded-lg text-sm font-medium">+ Add</button>
    </div>
    <!-- Quick add buttons -->
    <div class="mb-4">
      <p class="text-xs text-stone-500 mb-1">Quick add:</p>
      <div id="quick-add-btns" class="flex flex-wrap gap-1"></div>
    </div>
    <div id="pantry-list"></div>
  </div>

  <!-- Shopping Tab -->
  <div id="tab-shopping" class="tab-content">
    <h2 class="text-lg font-bold mb-3">ğŸ›’ Shopping List</h2>
    <div class="mb-3 p-3 bg-brand-50 rounded-lg border border-brand-200">
      <p class="text-sm font-medium mb-2">Select recipes to cook this week:</p>
      <div id="meal-plan-select" class="flex flex-wrap gap-1 max-h-40 overflow-y-auto"></div>
      <button onclick="generateShoppingList()" class="mt-2 bg-brand-600 text-white px-4 py-2 rounded-lg text-sm font-medium w-full">Generate Smart List</button>
    </div>
    <div class="flex gap-2 mb-3">
      <input id="shop-input" type="text" placeholder="Add item manuallyâ€¦" class="flex-1 px-3 py-2 rounded-lg border border-stone-300 text-sm" onkeydown="if(event.key==='Enter')addShopManual()">
      <button onclick="addShopManual()" class="bg-stone-700 text-white px-3 py-2 rounded-lg text-sm">+</button>
    </div>
    <div id="shop-list"></div>
    <div id="shop-actions" class="hidden mt-3 flex gap-2">
      <button onclick="copyShopList()" class="flex-1 bg-stone-200 text-stone-700 px-3 py-2 rounded-lg text-sm font-medium">ğŸ“‹ Copy List</button>
      <button onclick="addCheckedToPantry()" class="flex-1 bg-brand-600 text-white px-3 py-2 rounded-lg text-sm font-medium">âœ… Add to Pantry</button>
    </div>
  </div>

  <!-- Sodium Tab -->
  <div id="tab-sodium" class="tab-content">
    <h2 class="text-lg font-bold mb-3">ğŸ“Š Sodium Tracker</h2>
    <div id="sodium-today" class="mb-4"></div>
    <div class="mb-4">
      <p class="text-sm font-medium mb-2">Log a meal:</p>
      <div id="sodium-recipes" class="flex flex-wrap gap-1 max-h-48 overflow-y-auto"></div>
    </div>
    <div>
      <p class="text-sm font-medium mb-2">Last 7 days:</p>
      <div id="sodium-history"></div>
    </div>
  </div>
</main>

<!-- Bottom Nav -->
<nav class="fixed bottom-0 left-0 right-0 bg-white border-t border-stone-200 no-print z-50" style="padding-bottom:env(safe-area-inset-bottom,0)">
  <div class="max-w-2xl mx-auto flex">
    <button onclick="switchTab('recipes')" class="tab-btn flex-1 py-3 text-center text-xs font-medium" data-tab="recipes">
      <div class="text-xl">ğŸ“–</div>Recipes
    </button>
    <button onclick="switchTab('pantry')" class="tab-btn flex-1 py-3 text-center text-xs font-medium" data-tab="pantry">
      <div class="text-xl">ğŸ¥¬</div>Pantry
    </button>
    <button onclick="switchTab('shopping')" class="tab-btn flex-1 py-3 text-center text-xs font-medium" data-tab="shopping">
      <div class="text-xl">ğŸ›’</div>Shopping
    </button>
    <button onclick="switchTab('sodium')" class="tab-btn flex-1 py-3 text-center text-xs font-medium" data-tab="sodium">
      <div class="text-xl">ğŸ“Š</div>Sodium
    </button>
  </div>
</nav>

<script>
// ============ RECIPE DATA ============
const recipes = [
  // BREAKFAST
  {id:1,name:"Southwest Scramble",category:"Breakfast",time:"15 min",sodium:280,servings:2,
    ingredients:["4 large eggs","1 tbsp olive oil","1/2 red bell pepper, diced","1/4 red onion, diced","1/2 cup black beans (no-salt-added), rinsed","1/2 avocado, sliced","1/4 tsp cumin","1/4 tsp smoked paprika","Black pepper to taste","Fresh cilantro"],
    steps:["Heat olive oil in skillet over medium heat.","SautÃ© bell pepper and onion 3-4 min until soft.","Add black beans, cumin, paprika. Stir 1 min.","Push veggies to side, scramble eggs in open space.","Combine, top with avocado and cilantro."]},
  {id:2,name:"Turkey Sausage & Egg Wrap",category:"Breakfast",time:"15 min",sodium:350,servings:1,
    ingredients:["2 turkey sausage patties (low-sodium)","2 large eggs","1 flour tortilla (low-sodium)","1/4 avocado, mashed","Handful baby spinach","1 tsp olive oil","Black pepper"],
    steps:["Cook sausage patties in skillet per package directions. Slice.","Scramble eggs in olive oil, season with pepper.","Warm tortilla 15 sec in microwave.","Spread mashed avocado on tortilla.","Layer spinach, eggs, sausage. Roll up."]},
  {id:3,name:"Veggie Hash with Eggs",category:"Breakfast",time:"20 min",sodium:190,servings:2,
    ingredients:["2 medium potatoes, diced small","1 tbsp olive oil","1/2 zucchini, diced","1/2 red bell pepper, diced","1/4 onion, diced","2 cloves garlic, minced","4 eggs","1/4 tsp paprika","Black pepper","Fresh parsley"],
    steps:["Heat olive oil in large skillet over medium-high.","Add potatoes, cook 8-10 min stirring occasionally until golden.","Add zucchini, bell pepper, onion. Cook 4 min.","Add garlic, paprika, pepper. Stir 1 min.","Make 4 wells, crack eggs in. Cover, cook 4-5 min until whites set.","Top with parsley."]},
  {id:4,name:"Banana Oat Pancakes",category:"Breakfast",time:"15 min",sodium:120,servings:2,
    ingredients:["1 cup rolled oats","2 ripe bananas","2 eggs","1/2 tsp cinnamon","1/2 tsp vanilla extract","1 tbsp olive oil","Maple syrup for serving","Fresh berries"],
    steps:["Blend oats, bananas, eggs, cinnamon, vanilla until smooth.","Heat olive oil in skillet over medium.","Pour 1/4 cup batter per pancake.","Cook 2-3 min per side until golden.","Serve with maple syrup and berries."]},
  {id:5,name:"Loaded Avocado Toast",category:"Breakfast",time:"10 min",sodium:210,servings:1,
    ingredients:["2 slices low-sodium bread, toasted","1 ripe avocado","2 eggs","1 tsp olive oil","Cherry tomatoes, halved","Red pepper flakes","Black pepper","Squeeze of lemon"],
    steps:["Toast bread to preference.","Mash avocado with lemon juice and pepper.","Fry or poach eggs in olive oil.","Spread avocado on toast, top with eggs.","Add tomatoes and red pepper flakes."]},

  // LUNCH
  {id:6,name:"Mediterranean Chicken Bowl",category:"Lunch",time:"20 min",sodium:320,servings:2,
    ingredients:["2 chicken breasts, sliced thin","1 cup cooked rice","1 cucumber, diced","1 cup cherry tomatoes, halved","1/4 red onion, sliced thin","1/3 cup Kalamata olives, halved","2 tbsp olive oil","1 tbsp lemon juice","1 tsp dried oregano","Black pepper","Fresh parsley"],
    steps:["Season chicken with oregano and pepper.","Heat 1 tbsp olive oil, cook chicken 5-6 min per side.","Whisk remaining olive oil with lemon juice.","Build bowls: rice, chicken, cucumber, tomatoes, onion, olives.","Drizzle with lemon-oil dressing. Add parsley."]},
  {id:7,name:"Black Bean & Rice Bowl",category:"Lunch",time:"15 min",sodium:180,servings:2,
    ingredients:["1 can no-salt-added black beans, drained","1.5 cups cooked rice","1 avocado, diced","1/2 cup corn (frozen, thawed)","Handful cherry tomatoes, quartered","2 green onions, sliced","Juice of 1 lime","1 tbsp olive oil","1/4 tsp cumin","Fresh cilantro"],
    steps:["Warm beans with cumin in small pot.","Build bowls: rice, beans, corn, avocado, tomatoes.","Drizzle with lime juice and olive oil.","Top with green onions and cilantro."]},
  {id:8,name:"Chicken Lettuce Wraps",category:"Lunch",time:"15 min",sodium:290,servings:2,
    ingredients:["1 lb ground chicken","1 tbsp olive oil","3 cloves garlic, minced","1 tbsp rice vinegar","1 tbsp coconut aminos","1 tsp sesame oil (from sesame seeds, soy-free)","1/2 cup water chestnuts, diced","3 green onions, sliced","Butter lettuce leaves","Sriracha (optional)"],
    steps:["Heat olive oil over medium-high. Brown chicken, break into crumbles.","Add garlic, cook 1 min.","Add rice vinegar, coconut aminos, sesame oil. Stir.","Add water chestnuts, cook 2 min.","Spoon into lettuce cups, top with green onions."]},
  {id:9,name:"Tuna Salad Stuffed Peppers",category:"Lunch",time:"10 min",sodium:250,servings:2,
    ingredients:["2 cans low-sodium tuna, drained","2 large bell peppers, halved & seeded","1/4 cup olive oil mayo (soy-free)","1 stalk celery, diced","2 tbsp red onion, minced","1 tbsp lemon juice","Black pepper","Paprika"],
    steps:["Mix tuna, mayo, celery, onion, lemon juice, pepper.","Stuff into bell pepper halves.","Sprinkle with paprika.","Serve immediately or chill 30 min."]},
  {id:10,name:"Veggie & Hummus Wrap",category:"Lunch",time:"10 min",sodium:310,servings:1,
    ingredients:["1 large flour tortilla (low-sodium)","3 tbsp hummus (soy-free)","1/4 cucumber, sliced thin","1/4 cup shredded carrot","Handful baby spinach","1/4 avocado, sliced","Sprouts (optional)","Black pepper"],
    steps:["Spread hummus across tortilla.","Layer cucumber, carrot, spinach, avocado.","Add sprouts if using. Season with pepper.","Roll tightly, cut in half."]},

  // DINNER
  {id:11,name:"Lemon Herb Chicken with Roasted Vegetables",category:"Dinner",time:"30 min",sodium:290,servings:2,
    ingredients:["2 chicken breasts","2 tbsp olive oil","Juice of 1 lemon","3 cloves garlic, minced","1 tsp dried thyme","1 tsp dried rosemary","2 cups broccoli florets","1 large zucchini, sliced","1 red bell pepper, chunked","Black pepper"],
    steps:["Preheat oven to 425Â°F.","Marinate chicken in 1 tbsp olive oil, lemon, garlic, herbs, pepper.","Toss veggies with remaining olive oil and pepper on sheet pan.","Place chicken on pan with veggies.","Roast 22-25 min until chicken reaches 165Â°F."]},
  {id:12,name:"Garlic Shrimp with Pasta",category:"Dinner",time:"20 min",sodium:340,servings:2,
    ingredients:["1 lb shrimp, peeled & deveined","8 oz pasta (penne or linguine)","3 tbsp olive oil","5 cloves garlic, sliced","1/4 tsp red pepper flakes","Juice of 1 lemon","1/4 cup fresh parsley, chopped","Black pepper","Zest of 1 lemon"],
    steps:["Cook pasta per package. Reserve 1/2 cup pasta water. Drain.","Heat olive oil, sautÃ© garlic and red pepper flakes 1 min.","Add shrimp, cook 2-3 min per side until pink.","Add lemon juice, pasta, splash of pasta water. Toss.","Top with parsley and lemon zest."]},
  {id:13,name:"Beef Stir-Fry with Rice",category:"Dinner",time:"20 min",sodium:380,servings:2,
    ingredients:["12 oz flank steak, sliced thin against grain","2 tbsp coconut aminos","1 tbsp rice vinegar","1 tsp sesame oil (soy-free)","1 tbsp olive oil","1 cup broccoli florets","1 red bell pepper, sliced","1 cup snap peas","3 cloves garlic, minced","1 tsp fresh ginger, grated","Cooked rice"],
    steps:["Mix coconut aminos, rice vinegar, sesame oil in bowl.","Heat olive oil in wok/skillet over high heat.","Sear beef 2 min, remove and set aside.","Stir-fry broccoli, pepper, snap peas 3-4 min.","Add garlic, ginger, cook 30 sec.","Return beef with sauce, toss 1 min.","Serve over rice."]},
  {id:14,name:"Baked Salmon with Sweet Potato",category:"Dinner",time:"25 min",sodium:260,servings:2,
    ingredients:["2 salmon fillets (6 oz each)","2 medium sweet potatoes, cubed","2 tbsp olive oil","1 tbsp maple syrup","1 tsp Dijon mustard","1 tbsp lemon juice","1/2 tsp garlic powder","Black pepper","4 cups mixed greens","Lemon wedges"],
    steps:["Preheat oven to 400Â°F.","Toss sweet potatoes with 1 tbsp olive oil, pepper. Spread on pan.","Roast sweet potatoes 10 min.","Mix maple syrup, mustard, lemon juice. Brush on salmon.","Add salmon to pan. Roast 12-15 min more.","Serve with greens and lemon wedges."]},
  {id:15,name:"One-Pot Chicken & Rice",category:"Dinner",time:"30 min",sodium:310,servings:4,
    ingredients:["4 chicken thighs, boneless skinless","1.5 cups long grain rice","3 cups low-sodium chicken broth","1 tbsp olive oil","1 onion, diced","3 cloves garlic, minced","1 cup frozen peas","1 tsp turmeric","1/2 tsp cumin","Black pepper","Fresh lemon juice"],
    steps:["Season chicken with turmeric, cumin, pepper.","Heat olive oil, sear chicken 3 min per side. Remove.","SautÃ© onion 3 min, add garlic 1 min.","Add rice, stir 1 min. Add broth, bring to boil.","Nestle chicken in, cover, reduce to low. Cook 18 min.","Add peas last 3 min. Fluff rice, squeeze lemon."]},
  {id:16,name:"Stuffed Bell Peppers",category:"Dinner",time:"30 min",sodium:270,servings:4,
    ingredients:["4 large bell peppers, tops cut & seeded","1 lb ground turkey","1 cup cooked rice","1 can no-salt-added diced tomatoes","1/2 onion, diced","2 cloves garlic, minced","1 tsp Italian seasoning","1 tbsp olive oil","Black pepper","Fresh basil"],
    steps:["Preheat oven to 375Â°F.","Brown turkey with onion and garlic in olive oil.","Mix in rice, tomatoes, Italian seasoning, pepper.","Stuff peppers, place in baking dish.","Pour a little water in bottom of dish. Cover with foil.","Bake 25 min. Top with fresh basil."]},

  // SNACKS
  {id:17,name:"Apple & Almond Butter",category:"Snack",time:"5 min",sodium:5,servings:1,
    ingredients:["1 large apple, sliced","2 tbsp almond butter","Cinnamon (optional)","Drizzle of honey (optional)"],
    steps:["Slice apple.","Serve with almond butter for dipping.","Sprinkle cinnamon or drizzle honey if desired."]},
  {id:18,name:"Trail Mix",category:"Snack",time:"5 min",sodium:10,servings:4,
    ingredients:["1 cup unsalted almonds","1/2 cup unsalted cashews","1/2 cup dried cranberries","1/4 cup unsalted sunflower seeds","1/4 cup dark chocolate chips (dairy-free, soy-free)"],
    steps:["Combine all ingredients in bowl.","Divide into portions. Store in airtight container."]},
  {id:19,name:"Veggies & Hummus",category:"Snack",time:"5 min",sodium:160,servings:1,
    ingredients:["1/3 cup hummus (soy-free)","Carrot sticks","Cucumber slices","Bell pepper strips","Cherry tomatoes"],
    steps:["Wash and cut vegetables.","Serve with hummus for dipping."]},
  {id:20,name:"Frozen Banana Bites",category:"Snack",time:"10 min + freeze",sodium:2,servings:4,
    ingredients:["3 bananas, sliced into rounds","1/2 cup almond butter","1/2 cup dairy-free dark chocolate chips","1 tbsp coconut oil"],
    steps:["Spread almond butter between two banana slices to make sandwiches.","Place on parchment-lined tray, freeze 1 hour.","Melt chocolate with coconut oil.","Dip frozen bites halfway in chocolate.","Freeze another 30 min. Store in freezer bag."]},

  // FAMILY-SIZED DINNERS (4-6 servings)
  {id:21,name:"Slow Cooker Turkey Chili",category:"Dinner",time:"4-6 hrs (slow cooker)",sodium:320,servings:6,
    ingredients:["2 lbs ground turkey","2 cans no-salt-added diced tomatoes","1 can no-salt-added kidney beans, drained","1 can no-salt-added black beans, drained","1 large onion, diced","1 green bell pepper, diced","1 red bell pepper, diced","4 cloves garlic, minced","2 tbsp chili powder","1 tsp cumin","1 tsp smoked paprika","1/2 tsp oregano","1 tbsp olive oil","Black pepper to taste","Fresh cilantro","Avocado for topping"],
    steps:["Heat olive oil in skillet, brown turkey with onion and garlic. Drain excess fat.","Transfer to slow cooker. Add tomatoes, beans, peppers, and all spices.","Stir well, cover, and cook on low 6 hours or high 4 hours.","Taste and adjust seasonings.","Serve topped with cilantro and sliced avocado."]},
  {id:22,name:"Sheet Pan Lemon Herb Chicken & Vegetables",category:"Dinner",time:"40 min",sodium:280,servings:5,
    ingredients:["2.5 lbs bone-in chicken thighs (about 6-8 pieces)","1 lb baby potatoes, halved","2 cups broccoli florets","2 zucchini, sliced into half-moons","1 red onion, cut into wedges","3 tbsp olive oil","Juice of 2 lemons","4 cloves garlic, minced","1 tsp dried thyme","1 tsp dried rosemary","1/2 tsp paprika","Black pepper","Fresh parsley"],
    steps:["Preheat oven to 425Â°F.","Toss potatoes with 1 tbsp olive oil and pepper on a large sheet pan. Roast 10 min.","Mix remaining olive oil, lemon juice, garlic, thyme, rosemary, paprika, and pepper.","Coat chicken in half the herb mixture.","Add chicken to pan with potatoes. Roast 15 min.","Toss broccoli, zucchini, and onion in remaining herb mix. Add to pan.","Roast 15 min more until chicken reaches 165Â°F. Top with parsley."]},
  {id:23,name:"One-Pot Coconut Curry Chicken",category:"Dinner",time:"35 min",sodium:350,servings:6,
    ingredients:["2 lbs chicken breast, cubed","2 cans full-fat coconut milk","2 tbsp curry powder","1 tsp turmeric","1 tsp cumin","1 large onion, diced","4 cloves garlic, minced","1 tbsp fresh ginger, grated","2 cups diced sweet potato","2 cups baby spinach","1 red bell pepper, sliced","2 tbsp olive oil","Juice of 1 lime","Fresh cilantro","Cooked rice for serving"],
    steps:["Heat olive oil in large pot over medium-high. Season chicken with curry powder and pepper, sear 3 min per side. Remove.","SautÃ© onion 3 min, add garlic and ginger, cook 1 min.","Add coconut milk, turmeric, cumin, and sweet potato. Bring to simmer.","Cook 12-15 min until sweet potatoes are tender.","Return chicken, add bell pepper. Cook 5 min.","Stir in spinach until wilted. Squeeze lime over top.","Serve over rice, topped with cilantro."]},
  {id:24,name:"Family Taco Night (Ground Turkey)",category:"Dinner",time:"25 min",sodium:290,servings:6,
    ingredients:["2 lbs ground turkey","1 tbsp chili powder","1 tsp cumin","1 tsp smoked paprika","1/2 tsp garlic powder","1/2 tsp onion powder","1/4 tsp oregano","1 tbsp olive oil","12 corn tortillas","2 avocados, sliced","1 cup shredded lettuce","1 cup diced tomatoes","1/2 cup diced red onion","Fresh cilantro","Lime wedges","Hot sauce (optional)"],
    steps:["Heat olive oil in large skillet over medium-high. Brown turkey, breaking into crumbles.","Add all spices and 1/3 cup water. Stir and simmer 5 min until thickened.","Warm corn tortillas in dry skillet or microwave.","Set up taco bar: meat, avocado, lettuce, tomatoes, onion, cilantro, limes.","Let everyone build their own tacos."]},
  {id:25,name:"Baked Pasta with Roasted Vegetables",category:"Dinner",time:"45 min",sodium:310,servings:6,
    ingredients:["1 lb penne pasta","2 cups cherry tomatoes, halved","2 zucchini, diced","1 red bell pepper, diced","1 yellow bell pepper, diced","1 small eggplant, diced","1 onion, diced","4 cloves garlic, minced","3 tbsp olive oil","1 can no-salt-added crushed tomatoes","1 tsp Italian seasoning","1/2 tsp red pepper flakes","1/4 cup nutritional yeast","Fresh basil","Black pepper"],
    steps:["Preheat oven to 400Â°F. Toss zucchini, peppers, eggplant, and onion with 2 tbsp olive oil. Roast 20 min.","Cook pasta to just under al dente. Drain.","SautÃ© garlic in 1 tbsp olive oil 1 min. Add crushed tomatoes, Italian seasoning, red pepper flakes. Simmer 5 min.","Combine pasta, roasted veggies, and sauce in large baking dish. Add cherry tomatoes.","Sprinkle nutritional yeast on top. Bake 15 min.","Top with fresh basil."]},
  {id:26,name:"Family Stir-Fry with Coconut Aminos",category:"Dinner",time:"25 min",sodium:370,servings:5,
    ingredients:["1.5 lbs chicken breast, sliced thin","3 tbsp coconut aminos","1 tbsp rice vinegar","2 tsp sesame oil (soy-free)","1 tbsp cornstarch","2 tbsp olive oil","3 cups broccoli florets","2 red bell peppers, sliced","1 cup snap peas","2 carrots, sliced thin on diagonal","4 cloves garlic, minced","1 tbsp fresh ginger, grated","3 green onions, sliced","Cooked rice for serving"],
    steps:["Toss chicken with 1 tbsp coconut aminos and cornstarch. Let sit 5 min.","Mix remaining coconut aminos, rice vinegar, sesame oil, and 2 tbsp water for sauce.","Heat 1 tbsp olive oil in large wok over high heat. Sear chicken in batches 2-3 min. Remove.","Add remaining oil. Stir-fry broccoli, peppers, snap peas, and carrots 4-5 min.","Add garlic and ginger, cook 30 sec.","Return chicken, pour sauce over. Toss 1-2 min until glazed.","Serve over rice, top with green onions."]},
  {id:27,name:"Turkey Meatballs in Marinara",category:"Dinner",time:"40 min",sodium:340,servings:6,
    ingredients:["2 lbs ground turkey","1/2 cup breadcrumbs (check soy-free)","2 eggs","4 cloves garlic, minced","1 tsp Italian seasoning","1/2 tsp onion powder","Black pepper","2 tbsp olive oil","2 cans no-salt-added crushed tomatoes","1 small onion, finely diced","1 tsp dried basil","1/2 tsp dried oregano","1 lb spaghetti","Fresh basil"],
    steps:["Mix turkey, breadcrumbs, eggs, half the garlic, Italian seasoning, onion powder, and pepper. Form into 24 meatballs.","Heat 1 tbsp olive oil in large skillet. Brown meatballs on all sides, about 6 min. Remove.","In same pan, heat remaining oil. SautÃ© onion 3 min, add remaining garlic 1 min.","Add crushed tomatoes, basil, oregano. Simmer 5 min.","Nestle meatballs into sauce. Cover, simmer 15 min.","Cook spaghetti per package. Serve meatballs and sauce over pasta with fresh basil."]},
  {id:28,name:"Slow Cooker Chicken & Sweet Potato Stew",category:"Dinner",time:"5-7 hrs (slow cooker)",sodium:290,servings:6,
    ingredients:["2 lbs boneless skinless chicken thighs","3 medium sweet potatoes, cubed","2 cans no-salt-added diced tomatoes","1 large onion, diced","3 cloves garlic, minced","2 cups low-sodium chicken broth","1 tsp cumin","1 tsp smoked paprika","1/2 tsp cinnamon","1/2 tsp turmeric","2 cups baby spinach","1 tbsp olive oil","Juice of 1 lime","Fresh cilantro"],
    steps:["Place chicken thighs in slow cooker.","Add sweet potatoes, tomatoes, onion, garlic, broth, and all spices.","Cover and cook on low 6-7 hours or high 4-5 hours.","Shred chicken with two forks in the pot.","Stir in spinach until wilted, squeeze lime juice over.","Serve in bowls topped with cilantro."]},
  {id:29,name:"Sheet Pan Sausage & Roasted Vegetables",category:"Dinner",time:"35 min",sodium:380,servings:5,
    ingredients:["1.5 lbs chicken sausage links (low-sodium, soy-free), sliced","1 lb baby potatoes, quartered","2 cups Brussels sprouts, halved","2 red bell peppers, chunked","1 large red onion, cut into wedges","3 tbsp olive oil","1 tsp garlic powder","1 tsp smoked paprika","1/2 tsp dried thyme","Black pepper","1 tbsp balsamic vinegar"],
    steps:["Preheat oven to 425Â°F.","Toss potatoes and Brussels sprouts with 1 tbsp olive oil on a large sheet pan. Roast 10 min.","Toss sausage, peppers, and onion with remaining oil, garlic powder, paprika, and thyme.","Add to sheet pan, spread evenly. Roast 20-25 min, tossing halfway.","Drizzle with balsamic vinegar before serving."]},
  {id:30,name:"Chicken Burrito Bowls",category:"Dinner",time:"30 min",sodium:330,servings:6,
    ingredients:["2 lbs chicken breast","2 tbsp olive oil","1 tbsp chili powder","1 tsp cumin","1 tsp garlic powder","1/2 tsp smoked paprika","3 cups cooked rice","1 can no-salt-added black beans, drained","1 cup corn (frozen, thawed)","2 avocados, diced","1 cup cherry tomatoes, quartered","1/2 cup diced red onion","Juice of 2 limes","Fresh cilantro","Hot sauce (optional)"],
    steps:["Season chicken with chili powder, cumin, garlic powder, paprika, and pepper.","Heat olive oil in skillet. Cook chicken 6-7 min per side until 165Â°F. Rest 5 min, slice.","Warm black beans and corn in a small pot.","Mix lime juice with a drizzle of olive oil for dressing.","Build bowls: rice, beans, corn, sliced chicken, avocado, tomatoes, onion.","Drizzle with lime dressing, top with cilantro."]},
  {id:31,name:"Herb-Crusted Baked Salmon Family Style",category:"Dinner",time:"25 min",sodium:270,servings:5,
    ingredients:["2 lb salmon fillet (one large piece)","2 tbsp olive oil","Juice of 1 lemon","3 cloves garlic, minced","2 tbsp fresh dill, chopped","1 tbsp fresh parsley, chopped","1/2 tsp paprika","Black pepper","1 lb asparagus, trimmed","1 lb baby potatoes, halved","Lemon wedges"],
    steps:["Preheat oven to 400Â°F.","Toss potatoes with 1 tbsp olive oil on sheet pan. Roast 10 min.","Mix remaining olive oil, lemon juice, garlic, dill, parsley, paprika, and pepper.","Place salmon on pan with potatoes, add asparagus. Brush salmon with herb mixture.","Roast 15-18 min until salmon flakes easily.","Serve with lemon wedges."]},
  {id:32,name:"Vegetable & White Bean Soup",category:"Dinner",time:"35 min",sodium:300,servings:6,
    ingredients:["2 cans no-salt-added cannellini beans, drained","6 cups low-sodium vegetable broth","2 large carrots, diced","3 stalks celery, diced","1 large onion, diced","4 cloves garlic, minced","2 cups diced zucchini","2 cups baby spinach","1 can no-salt-added diced tomatoes","2 tbsp olive oil","1 tsp Italian seasoning","1/2 tsp dried thyme","Black pepper","Fresh parsley","Crusty bread for serving"],
    steps:["Heat olive oil in large pot. SautÃ© onion, carrots, and celery 5 min.","Add garlic, Italian seasoning, thyme. Cook 1 min.","Add broth, tomatoes, and beans. Bring to boil, reduce to simmer.","Cook 15 min until carrots are tender.","Add zucchini, cook 5 min. Stir in spinach until wilted.","Serve with parsley and crusty bread."]},

  // FAMILY-SIZED LUNCHES
  {id:33,name:"Big Batch Mediterranean Grain Bowls",category:"Lunch",time:"30 min",sodium:310,servings:5,
    ingredients:["2 cups uncooked quinoa","4 cups water","2 cans no-salt-added chickpeas, drained","2 cups cherry tomatoes, halved","2 cucumbers, diced","1 cup Kalamata olives, halved","1/2 cup red onion, diced","3 tbsp olive oil","Juice of 2 lemons","2 tsp dried oregano","Black pepper","Fresh parsley","4 cups arugula or mixed greens"],
    steps:["Cook quinoa in water per package directions. Fluff and let cool slightly.","Whisk olive oil, lemon juice, oregano, and pepper for dressing.","Toss chickpeas with half the dressing.","Build bowls: greens, quinoa, chickpeas, tomatoes, cucumber, olives, onion.","Drizzle remaining dressing. Top with parsley."]},
  {id:34,name:"Chicken Tortilla Soup",category:"Lunch",time:"35 min",sodium:350,servings:6,
    ingredients:["1.5 lbs chicken breast","6 cups low-sodium chicken broth","1 can no-salt-added diced tomatoes","1 can no-salt-added black beans, drained","1 cup corn (frozen)","1 large onion, diced","3 cloves garlic, minced","1 jalapeÃ±o, seeded and diced","2 tsp cumin","1 tsp chili powder","1 tbsp olive oil","Juice of 2 limes","Corn tortilla strips or chips","Avocado for topping","Fresh cilantro"],
    steps:["Heat olive oil in large pot. SautÃ© onion, garlic, and jalapeÃ±o 3 min.","Add broth, tomatoes, cumin, and chili powder. Bring to boil.","Add whole chicken breasts. Simmer 15-18 min until cooked through.","Remove chicken, shred with forks. Return to pot.","Add beans, corn. Cook 5 min.","Squeeze in lime juice. Serve with tortilla strips, avocado, and cilantro."]},
  {id:35,name:"Turkey & Veggie Lettuce Wrap Platter",category:"Lunch",time:"20 min",sodium:280,servings:5,
    ingredients:["1.5 lbs ground turkey","2 tbsp coconut aminos","1 tbsp rice vinegar","1 tsp sesame oil (soy-free)","4 cloves garlic, minced","1 tbsp fresh ginger, grated","1 cup shredded carrots","1 cup diced water chestnuts","4 green onions, sliced","2 heads butter lettuce, leaves separated","1 tbsp olive oil","Sriracha (optional)","Lime wedges"],
    steps:["Heat olive oil in large skillet over medium-high. Brown turkey.","Add garlic and ginger, cook 1 min.","Add coconut aminos, rice vinegar, sesame oil. Stir.","Add carrots and water chestnuts. Cook 2-3 min.","Arrange lettuce cups on platter, spoon filling into each.","Top with green onions and lime wedges. Serve family style."]},
  {id:36,name:"Veggie-Packed Minestrone",category:"Lunch",time:"40 min",sodium:290,servings:6,
    ingredients:["6 cups low-sodium vegetable broth","1 can no-salt-added diced tomatoes","1 can no-salt-added kidney beans, drained","1 cup small pasta (ditalini or elbow)","2 large carrots, diced","2 stalks celery, diced","1 large onion, diced","3 cloves garlic, minced","2 cups chopped kale or spinach","1 zucchini, diced","2 tbsp olive oil","1 tsp Italian seasoning","1/2 tsp dried basil","Black pepper","Fresh parsley"],
    steps:["Heat olive oil in large pot. SautÃ© onion, carrots, and celery 5 min.","Add garlic, Italian seasoning, basil. Cook 1 min.","Add broth and tomatoes. Bring to boil.","Add pasta and beans. Cook 8-10 min until pasta is tender.","Add zucchini and kale, cook 3-4 min.","Season with pepper. Serve with parsley."]},

  // FAMILY-SIZED BREAKFASTS
  {id:37,name:"Dairy-Free Breakfast Casserole",category:"Breakfast",time:"50 min",sodium:360,servings:6,
    ingredients:["12 large eggs","1 lb turkey sausage (low-sodium, soy-free), crumbled","1 tbsp olive oil","1 large red bell pepper, diced","1 small onion, diced","2 cups baby spinach","3 cups diced potatoes (or frozen hash browns)","1/2 tsp garlic powder","1/2 tsp smoked paprika","Black pepper","2 tbsp nutritional yeast","Fresh chives"],
    steps:["Preheat oven to 375Â°F. Grease a 9x13 baking dish with olive oil.","Cook sausage in skillet until browned. Remove.","In same skillet, sautÃ© potatoes 8 min until golden. Add bell pepper and onion, cook 3 min.","Whisk eggs with garlic powder, paprika, nutritional yeast, and pepper.","Layer potatoes, veggies, sausage, and spinach in baking dish.","Pour egg mixture over everything.","Bake 30-35 min until eggs are set in center. Top with chives."]},
  {id:38,name:"Big Batch Banana Oat Pancakes",category:"Breakfast",time:"25 min",sodium:130,servings:6,
    ingredients:["3 cups rolled oats","4 ripe bananas","6 eggs","1 tsp cinnamon","1 tsp vanilla extract","1 tsp baking powder","2 tbsp olive oil","Maple syrup for serving","Fresh berries","Almond butter (optional)"],
    steps:["Blend oats, bananas, eggs, cinnamon, vanilla, and baking powder until smooth.","Heat olive oil on griddle or large skillet over medium heat.","Pour 1/4 cup batter per pancake. Cook in batches.","Cook 2-3 min per side until golden brown.","Serve stacked with maple syrup, berries, and almond butter.","Leftovers freeze well â€” reheat in toaster."]},
  {id:39,name:"Sheet Pan Eggs & Veggie Bake",category:"Breakfast",time:"30 min",sodium:220,servings:6,
    ingredients:["12 eggs","2 cups cherry tomatoes, halved","2 bell peppers, diced","1 zucchini, diced","1/2 red onion, diced","2 cups baby spinach","2 tbsp olive oil","1/2 tsp garlic powder","1/2 tsp smoked paprika","Black pepper","Fresh basil or parsley","Avocado for serving"],
    steps:["Preheat oven to 400Â°F. Line a sheet pan with parchment, drizzle with olive oil.","Spread tomatoes, peppers, zucchini, and onion on pan. Drizzle with olive oil, season with garlic powder and paprika.","Roast 10 min.","Remove pan, add spinach. Make 12 wells in the veggies and crack an egg into each.","Season eggs with pepper. Return to oven 10-12 min until whites are set.","Top with fresh herbs. Serve with sliced avocado."]}
];

// ============ QUICK ADD ITEMS ============
const quickAddItems = {
  "ğŸ¥© Proteins": ["Eggs","Chicken breast","Turkey sausage","Smoked turkey","Beef stir fry","Shrimp","Tuna (canned)","Breakfast sausage","Breakfast links"],
  "ğŸ¥¦ Produce": ["Avocados","Bananas","Lemons","Bell peppers","Red onion","Yellow onion","Garlic","Ginger","Zucchini","Broccoli","Cauliflower","Sweet potatoes","Asparagus","Cucumber","Romaine","Tomatoes","Grape tomatoes","Cilantro","Parsley","Basil","Dill","Rosemary","Blueberries","Apples"],
  "ğŸ  Pantry": ["Rice","Tortillas","Olive oil","Hummus","Mustard","Kalamata olives","Walnuts","Nut & seed mix","Black pepper"],
};

// ============ STORE SECTIONS MAPPING ============
const storeSections = {
  "Produce":["avocado","banana","lemon","lime","bell pepper","onion","garlic","zucchini","broccoli","sweet potato","potato","spinach","baby spinach","cucumber","cherry tomato","tomato","cilantro","parsley","apple","carrot","lettuce","snap pea","green onion","celery","sprout","ginger","berries","cranberries"],
  "Meat & Seafood":["chicken","turkey","beef","steak","shrimp","salmon","tuna","sausage"],
  "Dairy-Free":["almond butter","coconut oil","chocolate chip","dark chocolate","maple syrup","honey"],
  "Pantry & Canned":["rice","pasta","oat","black bean","olive oil","broth","diced tomato","tortilla","coconut aminos","rice vinegar","sesame oil","hummus","water chestnut","Dijon mustard","vinegar","flour","baking"],
  "Grains & Bread":["bread","wrap","pita","oats","rolled oats"]
};

// ============ STATE ============
let pantry = JSON.parse(localStorage.getItem('pkd-pantry')||'[]');
let shopList = JSON.parse(localStorage.getItem('pkd-shop')||'[]');
let sodiumLog = JSON.parse(localStorage.getItem('pkd-sodium')||'{}');
let selectedMeals = new Set();
let expandedRecipe = null;

// ============ TAB SWITCHING ============
function switchTab(tab) {
  document.querySelectorAll('.tab-content').forEach(t=>t.classList.remove('active'));
  document.getElementById('tab-'+tab).classList.add('active');
  document.querySelectorAll('.tab-btn').forEach(b=>{
    b.classList.toggle('text-brand-700',b.dataset.tab===tab);
    b.classList.toggle('text-stone-400',b.dataset.tab!==tab);
  });
  if(tab==='pantry') renderPantry();
  if(tab==='shopping') renderShop();
  if(tab==='sodium') renderSodium();
  if(tab==='recipes') renderRecipes();
}

// ============ RECIPES ============
let activeCatFilter = 'All';
function filterRecipes(cat) {
  activeCatFilter = cat;
  document.querySelectorAll('.cat-filter').forEach(b => {
    b.className = b.dataset.cat === cat
      ? 'cat-filter px-4 py-2 rounded-full text-sm font-semibold bg-brand-600 text-white whitespace-nowrap'
      : 'cat-filter px-4 py-2 rounded-full text-sm font-semibold bg-stone-200 text-stone-600 whitespace-nowrap';
  });
  renderRecipes();
}
function renderRecipes() {
  const q = document.getElementById('recipe-search').value.toLowerCase();
  const cat = activeCatFilter;
  const filtered = recipes.filter(r => {
    if(cat!=='All' && r.category!==cat) return false;
    if(q && !r.name.toLowerCase().includes(q) && !r.ingredients.some(i=>i.toLowerCase().includes(q))) return false;
    return true;
  });
  const catOrder = {Breakfast:0, Lunch:1, Dinner:2, Snack:3};
  filtered.sort((a,b) => (catOrder[a.category]||0) - (catOrder[b.category]||0));
  const icons = {Breakfast:'ğŸ³',Lunch:'ğŸ¥—',Dinner:'ğŸ–',Snack:'ğŸ¥œ'};
  let lastCat = '';
  let countByCategory = {};
  filtered.forEach(r => { countByCategory[r.category] = (countByCategory[r.category]||0)+1; });
  document.getElementById('recipe-list').innerHTML = filtered.map(r=>{
    let header = '';
    if(cat==='All' && r.category!==lastCat) {
      lastCat = r.category;
      header = `<div class="flex items-center gap-2 mt-4 mb-2 first:mt-0"><h2 class="text-lg font-bold">${icons[r.category]} ${r.category}</h2><span class="text-xs text-stone-400">${countByCategory[r.category]} recipes</span></div>`;
    }
    return header+`
    <div class="recipe-card bg-white rounded-xl shadow-sm border border-stone-200 mb-3 overflow-hidden">
      <div class="p-4 cursor-pointer" onclick="toggleRecipe(${r.id})">
        <div class="flex items-center justify-between">
          <div>
            <span class="text-xs font-medium px-2 py-0.5 rounded-full bg-brand-100 text-brand-700">${icons[r.category]} ${r.category}</span>
            <h3 class="text-base font-bold mt-1">${r.name}</h3>
          </div>
          <div class="text-right text-xs text-stone-500">
            <div>â± ${r.time}</div>
            <div>ğŸ§‚ ${r.sodium}mg</div>
            <div>ğŸ‘¤ ${r.servings} serving${r.servings>1?'s':''}</div>
          </div>
        </div>
      </div>
      <div id="recipe-detail-${r.id}" class="${expandedRecipe===r.id?'':'hidden'} border-t border-stone-100 p-4 bg-stone-50">
        <div class="mb-3">
          <h4 class="font-semibold text-sm mb-1">Ingredients</h4>
          <ul class="text-sm space-y-0.5">${r.ingredients.map(i=>`<li class="flex items-start gap-1"><span class="text-brand-500 mt-0.5">â€¢</span>${i}</li>`).join('')}</ul>
        </div>
        <div>
          <h4 class="font-semibold text-sm mb-1">Instructions</h4>
          <ol class="text-sm space-y-1">${r.steps.map((s,i)=>`<li><span class="font-bold text-brand-600">${i+1}.</span> ${s}</li>`).join('')}</ol>
        </div>
      </div>
    </div>
  `}).join('') || '<p class="text-center text-stone-400 py-8">No recipes found</p>';
}

function toggleRecipe(id) {
  expandedRecipe = expandedRecipe===id ? null : id;
  renderRecipes();
}

// ============ PANTRY ============
function renderPantry() {
  const locs = ["ğŸ§Š Fridge","â„ï¸ Freezer","ğŸ  Pantry","ğŸ¥¦ Produce"];
  const now = Date.now();
  // Quick add buttons - show all categories
  let qhtml = '';
  for(const [cat, items] of Object.entries(quickAddItems)) {
    qhtml += `<p class="text-xs text-stone-500 mt-2 mb-1 w-full">${cat}</p>`;
    qhtml += items.map(i=>
      `<button onclick="prefillPantryItem('${i}')" class="text-xs px-2 py-1 rounded-full bg-brand-100 text-brand-700 hover:bg-brand-200">${i}</button>`
    ).join('');
  }
  document.getElementById('quick-add-btns').innerHTML = qhtml;
  // Pantry list
  let html = '';
  for(const l of locs) {
    const items = pantry.filter(p=>p.loc===l);
    if(!items.length) continue;
    html += `<div class="mb-4"><h3 class="font-semibold text-sm mb-1">${l}</h3>`;
    html += items.map(p=>{
      const age = (now - p.added)/(1000*60*60*24);
      const expireWarn = (l==='ğŸ¥¦ Produce' && age>5) || (l==='ğŸ§Š Fridge' && ['chicken','turkey','beef','steak','shrimp','salmon','ground'].some(m=>p.name.toLowerCase().includes(m)) && age>3);
      const qtyStr = p.qty ? `<span class="text-xs font-medium text-brand-700 bg-brand-100 px-1.5 py-0.5 rounded cursor-pointer" onclick="editPantryQty('${p.id}')">${p.qty}${p.unit?' '+p.unit:''}</span> ` : '';
      return `<div class="flex items-center justify-between py-1.5 px-2 rounded ${expireWarn?'bg-amber-50 border border-amber-200':''}">
        <span class="text-sm ${expireWarn?'text-amber-700':''}">${expireWarn?'âš ï¸ ':''}${qtyStr}${p.name} <span class="text-xs text-stone-400">${Math.floor(age)}d ago</span></span>
        <button onclick="removePantryItem('${p.id}')" class="text-red-400 hover:text-red-600 text-lg leading-none">&times;</button>
      </div>`;
    }).join('');
    html += '</div>';
  }
  document.getElementById('pantry-list').innerHTML = html || '<p class="text-center text-stone-400 py-4">Pantry is empty. Add some items!</p>';
}

function addPantryItem(name, loc, qty, unit) {
  pantry.push({id:Date.now().toString(36)+Math.random().toString(36).slice(2,6), name, loc, qty:qty||null, unit:unit||'', added:Date.now()});
  savePantry(); renderPantry();
}
function addPantryCustom() {
  const inp = document.getElementById('pantry-input');
  const name = inp.value.trim();
  if(!name) return;
  const qty = parseFloat(document.getElementById('pantry-qty').value)||null;
  const unit = document.getElementById('pantry-unit').value;
  addPantryItem(name, document.getElementById('pantry-loc').value, qty, unit);
  inp.value=''; document.getElementById('pantry-qty').value=''; document.getElementById('pantry-unit').value='';
}
function prefillPantryItem(name) {
  document.getElementById('pantry-input').value = name;
  document.getElementById('pantry-qty').focus();
}
function editPantryQty(id) {
  const item = pantry.find(p=>p.id===id);
  if(!item) return;
  const input = prompt(`Update qty for ${item.name}:`, item.qty||'');
  if(input===null) return;
  const val = parseFloat(input);
  if(!isNaN(val) && val>0) { item.qty=val; } else if(input==='') { item.qty=null; }
  savePantry(); renderPantry();
}
function removePantryItem(id) {
  pantry = pantry.filter(p=>p.id!==id);
  savePantry(); renderPantry();
}
function clearPantry() {
  if(!confirm('Clear your entire pantry?')) return;
  pantry=[]; savePantry(); renderPantry();
}
function savePantry() { localStorage.setItem('pkd-pantry',JSON.stringify(pantry)); }

document.getElementById('pantry-loc').addEventListener('change', renderPantry);

// ============ SHOPPING LIST ============
function renderMealPlanSelect() {
  document.getElementById('meal-plan-select').innerHTML = recipes.map(r=>
    `<button onclick="toggleMealSelect(${r.id})" class="text-xs px-2 py-1 rounded-full border ${selectedMeals.has(r.id)?'bg-brand-600 text-white border-brand-600':'bg-white text-stone-600 border-stone-300'}">${r.name}</button>`
  ).join('');
}

function toggleMealSelect(id) {
  selectedMeals.has(id) ? selectedMeals.delete(id) : selectedMeals.add(id);
  renderMealPlanSelect();
}

function generateShoppingList() {
  const pantryNames = pantry.map(p=>p.name.toLowerCase());
  let needed = [];
  for(const id of selectedMeals) {
    const r = recipes.find(x=>x.id===id);
    if(!r) continue;
    for(const ing of r.ingredients) {
      // Check if something similar is in pantry
      const ingLower = ing.toLowerCase();
      const inPantry = pantryNames.some(p => ingLower.includes(p.toLowerCase()) || p.toLowerCase().includes(ingLower.split(',')[0].replace(/[\d\/\s]+(?:tbsp|tsp|cup|oz|lb|can|large|medium|small|clove|head|bunch|handful|squeeze|drizzle|splash)/gi,'').trim()));
      if(!inPantry) {
        // Determine store section
        let section = 'Other';
        for(const [sec,keywords] of Object.entries(storeSections)) {
          if(keywords.some(k=>ingLower.includes(k))) { section=sec; break; }
        }
        if(!needed.some(n=>n.text===ing)) {
          needed.push({text:ing, section, checked:false, id:Date.now().toString(36)+Math.random().toString(36).slice(2,6)});
        }
      }
    }
  }
  shopList = [...needed, ...shopList.filter(s=>s.manual)];
  saveShop(); renderShop();
}

function renderShop() {
  renderMealPlanSelect();
  const sections = {};
  for(const item of shopList) {
    const s = item.section||'Other';
    if(!sections[s]) sections[s]=[];
    sections[s].push(item);
  }
  // Sort: unchecked first
  let html = '';
  for(const [sec,items] of Object.entries(sections)) {
    const sorted = [...items.filter(i=>!i.checked),...items.filter(i=>i.checked)];
    html += `<div class="mb-3"><h3 class="font-semibold text-sm mb-1">${sec}</h3>`;
    html += sorted.map(item=>
      `<div class="flex items-center gap-2 py-1.5 px-2 rounded ${item.checked?'check-done':''}">
        <input type="checkbox" ${item.checked?'checked':''} onchange="toggleShopItem('${item.id}')" class="w-4 h-4 accent-brand-600">
        <span class="text-sm flex-1">${item.text}</span>
        <button onclick="removeShopItem('${item.id}')" class="text-red-400 hover:text-red-600 text-lg leading-none">&times;</button>
      </div>`
    ).join('');
    html += '</div>';
  }
  document.getElementById('shop-list').innerHTML = html || '<p class="text-center text-stone-400 py-4">No items yet. Select recipes or add manually.</p>';
  document.getElementById('shop-actions').classList.toggle('hidden', shopList.length===0);
}

function toggleShopItem(id) {
  const item = shopList.find(i=>i.id===id);
  if(item) item.checked=!item.checked;
  saveShop(); renderShop();
}
function removeShopItem(id) {
  shopList = shopList.filter(i=>i.id!==id);
  saveShop(); renderShop();
}
function addShopManual() {
  const inp = document.getElementById('shop-input');
  const text = inp.value.trim();
  if(!text) return;
  shopList.push({text, section:'Other', checked:false, manual:true, id:Date.now().toString(36)+Math.random().toString(36).slice(2,6)});
  inp.value=''; saveShop(); renderShop();
}
function copyShopList() {
  const unchecked = shopList.filter(i=>!i.checked);
  const text = unchecked.map(i=>`â˜ ${i.text}`).join('\n');
  navigator.clipboard.writeText(text||'Nothing on the list!').then(()=>alert('Copied to clipboard!'));
}
function addCheckedToPantry() {
  const checked = shopList.filter(i=>i.checked);
  for(const item of checked) {
    // Guess pantry location
    const t = item.text.toLowerCase();
    let loc = 'ğŸ  Pantry';
    if(storeSections['Produce'].some(k=>t.includes(k))) loc='ğŸ¥¦ Produce';
    else if(storeSections['Meat & Seafood'].some(k=>t.includes(k))) loc='ğŸ§Š Fridge';
    pantry.push({id:Date.now().toString(36)+Math.random().toString(36).slice(2,6), name:item.text.split(',')[0].replace(/[\d\/]+\s*(tbsp|tsp|cup|oz|lb|can|cans)\s*/gi,'').trim(), loc, added:Date.now()});
  }
  shopList = shopList.filter(i=>!i.checked);
  savePantry(); saveShop(); renderShop();
  alert(`Added ${checked.length} item(s) to your pantry!`);
}
function saveShop() { localStorage.setItem('pkd-shop',JSON.stringify(shopList)); }

// ============ SODIUM TRACKER ============
function getTodayKey() { return new Date().toISOString().slice(0,10); }

function renderSodium() {
  const today = getTodayKey();
  if(!sodiumLog[today]) sodiumLog[today]={total:0,meals:[]};
  const data = sodiumLog[today];
  const pct = Math.min(100, data.total/2000*100);
  let color = 'bg-green-500';
  if(data.total>1700) color='bg-red-500';
  else if(data.total>1200) color='bg-yellow-500';

  document.getElementById('sodium-today').innerHTML = `
    <div class="bg-white rounded-xl p-4 shadow-sm border border-stone-200">
      <div class="flex justify-between items-end mb-2">
        <div>
          <span class="text-3xl font-bold">${data.total}</span>
          <span class="text-stone-400 text-sm">/ 2,000 mg</span>
        </div>
        <span class="text-xs text-stone-400">${today}</span>
      </div>
      <div class="w-full bg-stone-200 rounded-full h-4 overflow-hidden">
        <div class="${color} h-4 rounded-full transition-all duration-500" style="width:${pct}%"></div>
      </div>
      ${data.meals.length ? `<div class="mt-2 text-xs text-stone-500">${data.meals.map(m=>`${m.name} (+${m.sodium}mg)`).join(' Â· ')}</div>` : ''}
    </div>`;

  // Recipe buttons
  document.getElementById('sodium-recipes').innerHTML = recipes.map(r=>
    `<button onclick="logSodium(${r.id})" class="text-xs px-2 py-1 rounded-full border border-stone-300 bg-white hover:bg-brand-50">${r.name} <span class="text-stone-400">${r.sodium}mg</span></button>`
  ).join('');

  // History
  const days = [];
  for(let i=6;i>=0;i--) {
    const d = new Date(); d.setDate(d.getDate()-i);
    const key = d.toISOString().slice(0,10);
    days.push({key, total:(sodiumLog[key]||{total:0}).total, label:d.toLocaleDateString('en',{weekday:'short'})});
  }
  document.getElementById('sodium-history').innerHTML = `
    <div class="flex items-end gap-1 h-32">
      ${days.map(d=>{
        const h = Math.max(4, d.total/2000*100);
        let c='bg-green-400'; if(d.total>1700) c='bg-red-400'; else if(d.total>1200) c='bg-yellow-400';
        return `<div class="flex-1 flex flex-col items-center gap-1">
          <span class="text-[10px] text-stone-400">${d.total||'-'}</span>
          <div class="${c} rounded-t w-full" style="height:${h}%"></div>
          <span class="text-[10px] text-stone-500">${d.label}</span>
        </div>`;
      }).join('')}
    </div>`;
}

function logSodium(id) {
  const r = recipes.find(x=>x.id===id);
  if(!r) return;
  const today = getTodayKey();
  if(!sodiumLog[today]) sodiumLog[today]={total:0,meals:[]};
  sodiumLog[today].total += r.sodium;
  sodiumLog[today].meals.push({name:r.name,sodium:r.sodium});
  localStorage.setItem('pkd-sodium',JSON.stringify(sodiumLog));
  renderSodium();
}

// ============ INIT ============
document.getElementById('recipe-search').addEventListener('input', renderRecipes);

switchTab('recipes');
</script>
</body>
</html>
